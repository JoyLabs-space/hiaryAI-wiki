---
title: ハンドオフ
description: Delegate tasks from one agent to another
---

import { Code } from '@astrojs/starlight/components';

export const basicUsageExample = `import { Agent } from '@openai/agents';

// 専門エージェントを作成
const bookingAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: 'ユーザーの予約をサポートします。簡潔で役立つ対応を心がけてください。',
});

const refundAgent = new Agent({
  model: 'gpt-4o-mini', 
  instructions: '返金とキャンセルをサポートします。共感的な対応を心がけてください。',
});

// ハンドオフ機能付きのメインサポートエージェント
const supportAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: 'カスタマーサポートエージェントです。必要に応じて専門家に誘導してください。',
  handoffs: [bookingAgent, refundAgent],
});

// エージェントが専門家に転送できるようになります
const result = await supportAgent.run('予約をキャンセルして返金を受けたいです');`;

export const customizeHandoffExample = `import { Agent, handoff } from '@openai/agents';

const refundAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: '返金リクエストを専門的に処理します。',
});

const supportAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: 'カスタマーサポートを提供します。',
  handoffs: [
    handoff({
      agent: refundAgent,
      name: 'escalate_to_refund_specialist', 
      description: '複雑な返金問題について返金専門家に顧客を転送',
    }),
  ],
});`;

export const handoffInputExample = `import { Agent } from '@openai/agents';

const orderAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: '注文についてのお問い合わせを処理します。注文番号が提供されていない場合は必ず尋ねてください。',
});

const supportAgent = new Agent({
  model: 'gpt-4o-mini', 
  instructions: 'カスタマーサポートエージェント',
  handoffs: [orderAgent],
});

// 転送時、コンテキストが保持されます
const result = await supportAgent.run('注文番号#12345の配送が遅れています');
// orderAgentが受信: "注文番号#12345の配送が遅れています"`;

export const inputFilterExample = `import { Agent, handoff } from '@openai/agents';

const technicalAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: 'テクニカルサポート専門家',
});

const supportAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: '一般サポートエージェント',
  handoffs: [
    handoff({
      agent: technicalAgent,
      inputFilter: (input) => \`技術的問題: \${input}\`,
    }),
  ],
});`;

export const recommendedPromptExample = `import { Agent } from '@openai/agents';

const billingAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: \`請求処理の専門家です。

ハンドオフを受信した場合:
1. 転送を確認する
2. 必要に応じてアカウント詳細を尋ねる
3. 明確な請求サポートを提供する\`,
});

const supportAgent = new Agent({
  model: 'gpt-4o-mini',
  instructions: '請求に関する質問は請求専門家に転送してください。',
  handoffs: [billingAgent],
});`;

ハンドオフを使うと、あるエージェントが会話の一部を別のエージェントに委任できます。これは、異なるエージェントが特定の分野に特化している場合に便利です。たとえばカスタマーサポートのアプリでは、予約、返金、 FAQ を担当するエージェントを用意できます。

ハンドオフは LLM にとってツールとして表現されます。`Refund Agent` というエージェントにハンドオフする場合、ツール名は `transfer_to_refund_agent` になります。

## ハンドオフの作成

すべてのエージェントは `handoffs` オプションを受け付けます。この中には、他の `Agent` インスタンスや、`handoff()` ヘルパーが返す `Handoff` オブジェクトを含められます。

### 基本的な使い方

<Code lang="typescript" code={basicUsageExample} title="基本的なハンドオフ" />

### `handoff()` によるハンドオフのカスタマイズ

`handoff()` 関数を使うと、生成されるツールを調整できます。

- `agent` – ハンドオフ先のエージェント
- `toolNameOverride` – デフォルトの `transfer_to_<agent_name>` ツール名の上書き
- `toolDescriptionOverride` – デフォルトのツール説明の上書き
- `onHandoff` – ハンドオフが発生したときのコールバック。`RunContext` と、必要に応じてパース済み入力を受け取ります
- `inputType` – ハンドオフで期待する入力スキーマ
- `inputFilter` – 次のエージェントに渡す履歴のフィルター

<Code
  lang="typescript"
  code={customizeHandoffExample}
  title="カスタマイズされたハンドオフ"
/>

## ハンドオフの入力

ハンドオフを呼び出す際に、LLM にデータを提供させたい場合があります。入力スキーマを定義し、`handoff()` で使用します。

<Code lang="typescript" code={handoffInputExample} title="ハンドオフの入力" />

## 入力フィルター

デフォルトでは、ハンドオフは会話履歴全体を受け取ります。次のエージェントに渡す内容を変更するには、`inputFilter` を指定します。
一般的なヘルパーは `@openai/agents-core/extensions` にあります。

<Code lang="typescript" code={inputFilterExample} title="入力フィルター" />

## 推奨プロンプト

プロンプト内でハンドオフに言及しておくと、LLMはより安定して応答します。 SDK は、`RECOMMENDED_PROMPT_PREFIX` を通じて推奨のプレフィックスを提供します。

<Code
  lang="typescript"
  code={recommendedPromptExample}
  title="推奨プロンプト"
/>
